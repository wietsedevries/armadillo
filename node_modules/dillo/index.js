var io;
var connectSocket;
var thisRoom = 1000;

exports.initGame = function(sio, socket){
  io = sio;
  connectSocket = socket;
  connectSocket.emit('connected', { message: "You are connected!" });
  connectSocket.on('createNewGame', createNewGame);
  connectSocket.on('JoinGame', JoinGame);
  connectSocket.on('pressButton', pressButton);
};

function pressButton(data) {
  io.sockets.in(data.activeRoom).emit('clicked', data);
}

function createNewGame() {
  thisRoom += Math.floor((Math.random() * 1000));
  if ( thisRoom > 9999) {
    thisRoom = 1000;
  }
  this.emit('gameCreated', {activeRoom: thisRoom, socketId: this.id});
  this.join(thisRoom.toString());
}

function JoinGame(data) {
  data = {
      activeRoom : data.activeRoom
  };
  var sock = this;
  var room = io.nsps['/'].adapter.rooms[data.activeRoom];
  if( room !== undefined ){
    data.socketId = sock.id;
    sock.join(data.activeRoom);
    io.sockets.in(data.activeRoom).emit('joined', data);
  }
}
